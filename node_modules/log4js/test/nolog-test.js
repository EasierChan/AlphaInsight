"use strict";function MockLogger(){var e=this;this.messages=[],this.log=function(s,t,n){e.messages.push({level:s,message:t})},this.isLevelEnabled=function(s){return s.isGreaterThanOrEqualTo(e.level)},this.level=levels.TRACE}function MockRequest(e,s,t){this.socket={remoteAddress:e},this.originalUrl=t,this.method=s,this.httpVersionMajor="5",this.httpVersionMinor="0",this.headers={}}function MockResponse(e){var s=this;this.statusCode=e,this.end=function(e,t){s.emit("finish")}}var vows=require("vows"),assert=require("assert"),util=require("util"),EE=require("events").EventEmitter,levels=require("../lib/levels");util.inherits(MockResponse,EE),vows.describe("log4js connect logger").addBatch({getConnectLoggerModule:{topic:function(){var e=require("../lib/connect-logger");return e},'should return a "connect logger" factory':function(e){assert.isObject(e)},"nolog String":{topic:function(e){var s=new MockLogger,t=e.connectLogger(s,{nolog:"\\.gif"});return{cl:t,ml:s}},"check unmatch url request":{topic:function(e){var s=new MockRequest("my.remote.addr","GET","http://url/hoge.png"),t=new MockResponse(200),n=this.callback;e.cl(s,t,function(){}),t.end("chunk","encoding"),setTimeout(function(){n(null,e.ml.messages)},10)},"check message":function(e){assert.isArray(e),assert.equal(e.length,1),assert.ok(levels.INFO.isEqualTo(e[0].level)),assert.include(e[0].message,"GET"),assert.include(e[0].message,"http://url"),assert.include(e[0].message,"my.remote.addr"),assert.include(e[0].message,"200"),e.pop()}},"check match url request":{topic:function(e){var s=new MockRequest("my.remote.addr","GET","http://url/hoge.gif"),t=new MockResponse(200),n=this.callback;e.cl(s,t,function(){}),t.end("chunk","encoding"),setTimeout(function(){n(null,e.ml.messages)},10)},"check message":function(e){assert.isArray(e),assert.equal(e.length,0)}}},"nolog Strings":{topic:function(e){var s=new MockLogger,t=e.connectLogger(s,{nolog:"\\.gif|\\.jpe?g"});return{cl:t,ml:s}},"check unmatch url request (png)":{topic:function(e){var s=new MockRequest("my.remote.addr","GET","http://url/hoge.png"),t=new MockResponse(200),n=this.callback;e.cl(s,t,function(){}),t.end("chunk","encoding"),setTimeout(function(){n(null,e.ml.messages)},10)},"check message":function(e){assert.isArray(e),assert.equal(e.length,1),assert.ok(levels.INFO.isEqualTo(e[0].level)),assert.include(e[0].message,"GET"),assert.include(e[0].message,"http://url"),assert.include(e[0].message,"my.remote.addr"),assert.include(e[0].message,"200"),e.pop()}},"check match url request (gif)":{topic:function(e){var s=new MockRequest("my.remote.addr","GET","http://url/hoge.gif"),t=new MockResponse(200),n=this.callback;e.cl(s,t,function(){}),t.end("chunk","encoding"),setTimeout(function(){n(null,e.ml.messages)},10)},"check message":function(e){assert.isArray(e),assert.equal(e.length,0)}},"check match url request (jpeg)":{topic:function(e){var s=new MockRequest("my.remote.addr","GET","http://url/hoge.jpeg"),t=new MockResponse(200),n=this.callback;e.cl(s,t,function(){}),t.end("chunk","encoding"),setTimeout(function(){n(null,e.ml.messages)},10)},"check message":function(e){assert.isArray(e),assert.equal(e.length,0)}}},"nolog Array<String>":{topic:function(e){var s=new MockLogger,t=e.connectLogger(s,{nolog:["\\.gif","\\.jpe?g"]});return{cl:t,ml:s}},"check unmatch url request (png)":{topic:function(e){var s=new MockRequest("my.remote.addr","GET","http://url/hoge.png"),t=new MockResponse(200),n=this.callback;e.cl(s,t,function(){}),t.end("chunk","encoding"),setTimeout(function(){n(null,e.ml.messages)},10)},"check message":function(e){assert.isArray(e),assert.equal(e.length,1),assert.ok(levels.INFO.isEqualTo(e[0].level)),assert.include(e[0].message,"GET"),assert.include(e[0].message,"http://url"),assert.include(e[0].message,"my.remote.addr"),assert.include(e[0].message,"200"),e.pop()}},"check match url request (gif)":{topic:function(e){var s=new MockRequest("my.remote.addr","GET","http://url/hoge.gif"),t=new MockResponse(200),n=this.callback;e.cl(s,t,function(){}),t.end("chunk","encoding"),setTimeout(function(){n(null,e.ml.messages)},10)},"check message":function(e){assert.isArray(e),assert.equal(e.length,0)}},"check match url request (jpeg)":{topic:function(e){var s=new MockRequest("my.remote.addr","GET","http://url/hoge.jpeg"),t=new MockResponse(200),n=this.callback;e.cl(s,t,function(){}),t.end("chunk","encoding"),setTimeout(function(){n(null,e.ml.messages)},10)},"check message":function(e){assert.isArray(e),assert.equal(e.length,0)}}},"nolog RegExp":{topic:function(e){var s=new MockLogger,t=e.connectLogger(s,{nolog:/\.gif|\.jpe?g/});return{cl:t,ml:s}},"check unmatch url request (png)":{topic:function(e){var s=new MockRequest("my.remote.addr","GET","http://url/hoge.png"),t=new MockResponse(200),n=this.callback;e.cl(s,t,function(){}),t.end("chunk","encoding"),setTimeout(function(){n(null,e.ml.messages)},10)},"check message":function(e){assert.isArray(e),assert.equal(e.length,1),assert.ok(levels.INFO.isEqualTo(e[0].level)),assert.include(e[0].message,"GET"),assert.include(e[0].message,"http://url"),assert.include(e[0].message,"my.remote.addr"),assert.include(e[0].message,"200"),e.pop()}},"check match url request (gif)":{topic:function(e){var s=new MockRequest("my.remote.addr","GET","http://url/hoge.gif"),t=new MockResponse(200),n=this.callback;e.cl(s,t,function(){}),t.end("chunk","encoding"),setTimeout(function(){n(null,e.ml.messages)},10)},"check message":function(e){assert.isArray(e),assert.equal(e.length,0)}},"check match url request (jpeg)":{topic:function(e){var s=new MockRequest("my.remote.addr","GET","http://url/hoge.jpeg"),t=new MockResponse(200),n=this.callback;e.cl(s,t,function(){}),t.end("chunk","encoding"),setTimeout(function(){n(null,e.ml.messages)},10)},"check message":function(e){assert.isArray(e),assert.equal(e.length,0)}}}}})["export"](module);