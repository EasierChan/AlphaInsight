"use strict";function RollingFileSync(e,n,i,t){function r(){if(!e||!n||0>=n)throw new Error("You must specify a filename and file size")}function o(n){var i=0;try{i=fs.statSync(n).size}catch(t){fs.appendFileSync(e,"")}return i}debug("In RollingFileStream"),r(),this.filename=e,this.size=n,this.backups=i||1,this.options=t||{encoding:"utf8",mode:parseInt("0644",8),flags:"a"},this.currentSize=0,this.currentSize=o(this.filename)}function fileAppender(e,n,i,t,r){function o(e,n,i){var t;return t=n?new RollingFileSync(e,n,i):function(e){return fs.existsSync(e)||fs.appendFileSync(e,""),{write:function(n){fs.appendFileSync(e,n)}}}(e)}debug("fileSync appender created");e=path.normalize(e),n=n||layouts.basicLayout,t=void 0===t?5:t,t=0===t?1:t;var s=o(e,i,t);return function(e){s.write(n(e,r)+eol)}}function configure(e,n){var i;return e.layout&&(i=layouts.layout(e.layout.type,e.layout)),n&&n.cwd&&!e.absolute&&(e.filename=path.join(n.cwd,e.filename)),fileAppender(e.filename,i,e.maxLogSize,e.backups,e.timezoneOffset)}var debug=require("../debug")("fileSync"),layouts=require("../layouts"),path=require("path"),fs=require("fs"),streams=require("../streams"),os=require("os"),eol=os.EOL||"\n";RollingFileSync.prototype.shouldRoll=function(){return debug("should roll with current size %d, and max size %d",this.currentSize,this.size),this.currentSize>=this.size},RollingFileSync.prototype.roll=function(e){function n(e){return u.test(e)}function i(n){return parseInt(n.substring((path.basename(e)+".").length),10)||0}function t(e,n){return i(e)>i(n)?1:i(e)<i(n)?-1:0}function r(n){var t=i(n);if(debug("Index of "+n+" is "+t),t<s.backups){try{fs.unlinkSync(e+"."+(t+1))}catch(r){}debug("Renaming "+n+" -> "+e+"."+(t+1)),fs.renameSync(path.join(path.dirname(e),n),e+"."+(t+1))}}function o(){debug("Renaming the old files");var i=fs.readdirSync(path.dirname(e));i.filter(n).sort(t).reverse().forEach(r)}var s=this,u=new RegExp("^"+path.basename(e));debug("Rolling, rolling, rolling"),o()},RollingFileSync.prototype.write=function(e,n){function i(){debug("writing the chunk to the file"),t.currentSize+=e.length,fs.appendFileSync(t.filename,e)}var t=this;debug("in write"),this.shouldRoll()&&(this.currentSize=0,this.roll(this.filename)),i()},exports.appender=fileAppender,exports.configure=configure;