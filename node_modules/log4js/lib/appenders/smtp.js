"use strict";function sendBuffer(){if(logEventBuffer.length>0){for(var e=getTransportOptions(config),t=mailer.createTransport(e),n=logEventBuffer[0],o="",s=logEventBuffer.length;logEventBuffer.length>0;)o+=layout(logEventBuffer.shift(),config.timezoneOffset)+"\n";var u={to:config.recipients,subject:config.subject||subjectLayout(n),headers:{Hostname:os.hostname()}};!0===config.attachment.enable?(u[config.html?"html":"text"]=config.attachment.message,u.attachments=[{filename:config.attachment.filename,contentType:"text/x-log",content:o}]):u[config.html?"html":"text"]=o,config.sender&&(u.from=config.sender),t.sendMail(u,function(e){e&&console.error("log4js.smtpAppender - Error happened",e),t.close(),unsentCount-=s})}}function getTransportOptions(){var e=null;if(config.SMTP)e=config.SMTP;else if(config.transport){var t=config.transport.plugin||"smtp",n="nodemailer-"+t+"-transport",o=require(n);e=o(config.transport.options)}return e}function scheduleSend(){sendTimer||(sendTimer=setTimeout(function(){sendTimer=null,sendBuffer()},sendInterval))}function smtpAppender(e,t){return config=e,config.attachment||(config.attachment={}),config.attachment.enable=!!config.attachment.enable,config.attachment.message=config.attachment.message||"See logs as attachment",config.attachment.filename=config.attachment.filename||"default.log",layout=t||layouts.basicLayout,subjectLayout=layouts.messagePassThroughLayout,sendInterval=1e3*config.sendInterval||0,shutdownTimeout=1e3*("shutdownTimeout"in config?config.shutdownTimeout:5),function(e){unsentCount++,logEventBuffer.push(e),sendInterval>0?scheduleSend():sendBuffer()}}function configure(e){return config=e,e.layout&&(layout=layouts.layout(e.layout.type,e.layout)),smtpAppender(e,layout)}function shutdown(e){shutdownTimeout>0&&setTimeout(function(){sendTimer&&clearTimeout(sendTimer),sendBuffer()},shutdownTimeout),function t(){unsentCount>0?setTimeout(t,100):e()}()}var layouts=require("../layouts"),mailer=require("nodemailer"),os=require("os"),logEventBuffer=[],subjectLayout,layout,unsentCount=0,shutdownTimeout,sendInterval,sendTimer,config;exports.name="smtp",exports.appender=smtpAppender,exports.configure=configure,exports.shutdown=shutdown;